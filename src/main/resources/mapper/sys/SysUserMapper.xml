<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.maojx0630.rbac.sys.mapper.SysUserMapper">
	<select id="countByUsernameAndId" resultType="java.lang.Long">
		select count(*)
		from sys_user
				where username = #{username,jdbcType=VARCHAR}
				  and del_flag = #{notDeleteValue}
		<if test="id != null">
			and id != #{id,jdbcType=BIGINT}
		</if>
	</select>

	<!--auto generated by MybatisCodeHelper on 2019-07-25-->
	<select id="countByPhoneAndId" resultType="java.lang.Long">
		select count(*)
		from sys_user
				where phone = #{phone,jdbcType=VARCHAR}
				  and del_flag = #{notDeleteValue}
		<if test="id != null">
			and id != #{id,jdbcType=BIGINT}
		</if>
	</select>


	<!--auto generated by MybatisCodeHelper on 2019-07-26-->
	<update id="putUser">
		update sys_user
		<set>
			<if test="updated.id != null">
				id = #{updated.id,jdbcType=BIGINT},
			</if>
			<if test="updated.username != null">
				username = #{updated.username,jdbcType=VARCHAR},
			</if>
			<if test="updated.phone != null">
				phone = #{updated.phone,jdbcType=VARCHAR},
			</if>
			<if test="updated.password != null">
				password = #{updated.password,jdbcType=VARCHAR},
			</if>
			<if test="updated.deptId != null">
				dept_id = #{updated.deptId,jdbcType=BIGINT},
			</if>
			<if test="updated.status != null">
				status = #{updated.status,jdbcType=INTEGER},
			</if>
			<if test="updated.remark != null">
				remark = #{updated.remark,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=BIGINT}
	</update>

	<select id="getUserList" resultType="com.github.maojx0630.rbac.sys.model.SysUser">
		select id, username, phone, dept_id, `status`, remark
		from sys_user
				where del_flag = #{param.notDeleteValue}
		<if test="param.phone != null and param.phone != ''">
			and phone like concat('%', #{param.phone}, '%')
		</if>
		<if test="param.username != null and param.username != ''">
			and username like concat('%', #{param.username,jdbcType=VARCHAR}, '%')
		</if>
		order by update_date desc
	</select>
</mapper>